<html>
<head>
  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1" media="(device-height: 568px)">
  <style type="text/css">
    body {
      padding: 0;
      margin: 0;
      font: bold 11px/14px "Helvetica Neue", Helvetica, Arial, sans-serif;
      text-rendering: optimizeLegibility;
      overflow: hidden;
    }
    .patreon-btn {
      height: 20px;
      overflow: hidden;
      white-space: nowrap;
    }
    .p-ico {
      float: left;
    }
    .p-btn,
    .p-numbers {
      border-radius: 3px;
      color: #555;
      cursor: pointer;
      display: inline-block;
      padding: 2px 5px 2px 4px;
      text-decoration: none;
      text-shadow: 0 1px 0 #fff;
      white-space: nowrap;
    }
    .p-btn {
      background-color: #e6e6e6;
      background-image: -moz-linear-gradient(top, #fafafa, #e7e7e7);
      background-image: -ms-linear-gradient(#fafafa, #e7e7e7);
      background-image: -o-linear-gradient(#fafafa, #e7e7e7);
      background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#fafafa), to(#e7e7e7));
      background-image: -webkit-linear-gradient(#fafafa, #e7e7e7);
      background-image: linear-gradient(#fafafa, #e7e7e7);
      background-repeat: no-repeat;
      border-bottom-color: #bcbcbc;
      border: 1px solid #d4d4d4;
    }
    .p-btn:hover,
    .p-btn:focus,
    .p-btn:active {
      color: #fff;
      text-decoration: none;
      text-shadow: 0 -1px 0 rgba(0,0,0,.25);
      border-color: #518cc6 #518cc6 #2a65a0;
      background-color: #3072b3;
    }
    .p-btn:hover,
    .p-btn:focus {
      background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#599bdc), to(#3072b3));
      background-image: -webkit-linear-gradient(#599bdc, #3072b3);
      background-image: -moz-linear-gradient(top, #599bdc, #3072b3);
      background-image: -ms-linear-gradient(#599bdc, #3072b3);
      background-image: -o-linear-gradient(#599bdc, #3072b3);
      background-image: linear-gradient(#599bdc, #3072b3);
    }
    .p-btn:active {
      background-image: none;
      -webkit-box-shadow: inset 0 2px 5px rgba(0,0,0,.10);
         -moz-box-shadow: inset 0 2px 5px rgba(0,0,0,.10);
              box-shadow: inset 0 2px 5px rgba(0,0,0,.10);
    }
    .p-ico {
      width: 15px;
      height: 15px;
      margin-top: -1px;
      margin-right: 4px;
      vertical-align: middle;
      background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAABQCAQAAABGtxZMAAAFjElEQVRIx42WX0wUVxjFj0WRRJHGVNSUJmoTI4aqpcqjIYCaGkPUmpbapH1BUxFErCGGGF98MI2lCBFN7Uub1KZJq40PjX+AGF61drvSpaVGt5Qq4mQyDOPN5TpcTx/u7B/YnYU7T3tnfjv5vnO+cweYuQpQgUZE4COCBlSgADlXMdoQA9MujRjaUBwG1CE+7fHUFcf72YAziQfK3CbrkvWT+Mpqssu8JHY6BNji3rS1YnJNqRvOZjcbVGc2m12V9nhiTcpDVgDtSxU9YoDkU3pCjvqepA5++w0OCGIYrxnkJAi+474I3nDH3e0Ui0J/udhj33XMnvLLTVUnjA5DIPxe29z8xlkgU72aL74N9m850CBiKAAqoMEyzxR9182T0xucryKeacR6D4RGOdAIgs3mv3Stk6nKXsfU1Gw6dxCIguDXFklOyGUiE1nmPRckecH0rR9QIHhFkuQTv9DPRBarUUWS3xvEASQIXlUk+UQv0eFvuWiQ23NA9gW1NJla6mdFFqrfhenYumTHciIL5WXL6HLDTemSgex3P3KWe4Wq2P3AMZqQk2qjUb8VyIK0K+rn4ql6LpIeU/VWMDdLsyJn5HQnS3Ug4eS9xpQZyOci9bgvf3HfTszLqYT1M5DXvcNOt3XZumAddtamDHQqNV6z6gLiQWq4gMAwBhmx58/0mEYUrYnBSqxR2HCueSQ58nheHHby6kM9ypGP2RYLWMFGRugzwgZWMHf0sZhtjE3rsGaMbQyLPtYxzuwrzmzRxzOJ+wNul3XAek8ctLrsAS+JnQ4B7rjb7VdUqmN5aodz180Csc7snXPzVaYqC+WFwM3clyp6xAApNQrlCn+xREJYv9vk2TCNQjxJkr+6C1Qil392xsSE/1RctbcEhsn375mqThgdhkj61ba5+YnzIs3Jvvg42N9mxjnGArCCmhzwTNGb3akZ1ldqk2caEfNIapaDjSR5zvyXvuZkinLFRCs7TecOglGSNFNXKJ+JTOSZt0iA4CHTt35QkeReCYIr/Qk/E/HUCgWCHxrEASVJ7lEguFK7Ovwtnxrk9hyQH4Naukwt9bMik2qjMB37M9mxnMik3B+kyw43pUsGctn9znnqTagx9wdnk5eMWaN+K5AFOaagF4nlapFIekyZ84dxLs2KnJhx9BWoSwknm+jLRFrTUma+3On+lpiXRJJlIv95550Ga791yDrv/J0yUCr6ZteF5AOmR58xjEFKbH+mxzSjbOX06OMobTq1HgiWPH4Zp528+ljPcuaIvgJUoRsC3aia7UvPrN2IgOA8o0QEtbMBx6GL2CJ6RFT1iBZRRGgcywXUQr/lD6Z9icVkqYLGrvAaBor0kCIfqSPiXdUs4pL8S71KRMNqqgRbBPlQlQShVCIfKfKoBLE1O3IR7BPk4TSbNAmyV4LoyI7IVzjgk9vSPnhqJBkV8zRGsyMqj/c1uSPtlDwiyD4Jon2OyBsy7pPNOWoJkCq9Xn0mdsoW8Y8iB2VRjo4FyFZdncywP+RaCY2dYboESLV+U90SEXFLHhFLCI2j4doHSI0fnPMEcS9ceQAYzbMHFbl1GDYcjOEsKudw1gfnfRW7KdjNKs7F/NzNAZJ8aQY5ytnMz+PkOL8UNWKDqhEdwiXJXOZnLXnfL007i9fLQUVyV3gNsXG9VoFrVJe4rjrFagmuU+Mmf7MilWS7ANeokWDIRuRqBXZIktkNw4tklQDPp8VRlwCrJMns5qfSLPPBm2lHXo8ENwiS2c1Pf4plGryRlpOdAqyWJNtD3jIT+Veu8sFzOWoJkD49qL4Q12WHWKXAUjlODoR1LED6dW9ylMvkkCQZZv4E0qsfqu1ik9gmO8UESYabP1F+T/pHQoS5zM+xKbtUwe8fpkuHFs+ykjnN/z/aOgppjQ6ziwAAAABJRU5ErkJggg==);
      background-repeat: no-repeat;
      background-position: 0 -65px;
    }
    .p-btn:hover .p-ico,
    .p-btn:focus .p-ico,
    .p-btn:active .p-ico {
      background-position: 0 -50px;
    }
    .p-numbers {
      position: relative;
      display: none; /* hidden to start */
      margin-left: 4px;
      background-color: #fafafa;
      border: 1px solid #d4d4d4;
    }
    .p-numbers:hover,
    .p-numbers:focus {
      color: #4183C4;
    }
    .p-numbers:before,
    .p-numbers:after {
      content: ' ';
      position: absolute;
      display: inline-block;
      width: 0;
      height: 0;
      border-color: transparent;
      border-style: solid;
    }
    .p-numbers:before {
      top: 50%;
      left: -3px;
      margin-top: -4px;
      border-width: 4px 4px 4px 0;
      border-right-color: #fafafa;
    }
    .p-numbers:after {
      top: 50%;
      left: -4px;
      z-index: -1;
      margin-top: -5px;
      border-width: 5px 5px 5px 0;
      border-right-color: #d4d4d4;
    }
    .patreon-btn-large {
      height: 30px;
    }
    .patreon-btn-large .p-btn,
    .patreon-btn-large .p-numbers {
      padding: 2px 10px 2px 8px;
      font-size: 16px;
      line-height: 24px;
      border-radius: 4px;
    }
    .patreon-btn-large .p-ico {
      width: 25px;
      height: 25px;
      background-position: 0 -25px;
    }
    .patreon-btn-large .p-btn:hover .p-ico,
    .patreon-btn-large .p-btn:focus .p-ico,
    .patreon-btn-large .p-btn:active .p-ico {
      background-position: 0 0;
    }
    .patreon-btn-large .p-numbers {
      margin-left: 6px;
    }
    .patreon-btn-large .p-numbers:before {
      left: -5px;
      margin-top: -6px;
      border-width: 6px 6px 6px 0;
    }
    .patreon-btn-large .p-numbers:after {
      left: -6px;
      margin-top: -7px;
      border-width: 7px 7px 7px 0;
    }
  </style>
</head>

<body>
  <span class="patreon-btn" id="patreon-btn">
    <a class="p-btn" id="p-btn" href="#" target="_blank">
      <span class="p-ico"></span>
      <span class="p-text" id="p-text">Patreon</span>
    </a>
    <a class="p-numbers" id="p-numbers" href="#" target="_blank"></a>
  </span>

  <script type="text/javascript">
    // Function to parse the document location's query parameters and return
    // them as object.
    function getParamsFromUrl() {
      var params = {
          creator: '',
          show: '',
          unit: ''
        },
        hash,
        query = window.location.search.slice( 1 ),
        hashes = query.split('&');

      for ( var i = 0; i < hashes.length; i++ ) {
        hash = hashes[i].split('=');
        params[ hash[0] ] = hash[1];
      }

      return params;
    }


    // Function to fetch the numbers from Patreon, through YQL.
    function queryYQL( params ) {
      var scriptElem;

      // No creator given?  PASS.
      if ( !params.creator ) {
        yqlCallback({});
        return;
      }

      scriptElem = document.createElement('script');
      scriptElem.src = [
        'https://query.yahooapis.com/v1/public/yql?q=',
        encodeURIComponent( 'select * from html where url="http://www.patreon.com/' + params.creator + '" and xpath="//div[@id=\'totalPatrons\']//text() | (//span[@id=\'totalEarnings\'])[1]/text()"' ),
        '&format=json',
        '&callback=yqlCallback'
      ].join('');

      head.insertBefore( scriptElem, head.firstChild );
    }


    function yqlCallback( obj ) {
      var returnValue = ( obj && obj.query && obj.query.results ) || '',
        patrons,
        money,
        displayString = '';

      returnValue = returnValue.replace( /^\s*(.*)\s*$/m, '$1' ).split( /\s+/ );

      if ( !returnValue.length ) {
        displayString = 'N/A';
      }
      else {
        patrons = returnValue[ 0 ];
        money = [
          '$',
          returnValue[ 1 ].replace( /\.\d+$/, '' ),
          params.unit ? ( '/' + params.unit ) : ''
        ].join('');

        switch ( params.show ) {
          case 'patrons':
            displayString = patrons + ' patrons';
            break;

          case 'both':
            displayString = patrons + ' &#187; ' + money;
            break;

          default:
            displayString = money;
            break;
        }
      }

      counter.innerHTML = displayString;
      counter.style.display = 'inline-block';
    }


    // Set variables.
    var params = getParamsFromUrl(),
      creator = params.creator,
      size = params.size,
      head = document.getElementsByTagName('head')[0],
      mainButton = document.getElementById('patreon-btn'),
      button = document.getElementById('p-btn'),
      counter = document.getElementById('p-numbers');


    // Set `href` for button and counter.
    button.href = counter.href = 'http://patreon.com/' + creator;

    // Change the size if requested.
    if ( size === 'large' ) {
      mainButton.className += ' patreon-btn-large';
    }

    // GO!  Fetch the numbers.
    queryYQL( params );
  </script>

</body>
</html>
